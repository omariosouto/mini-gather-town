<style>
  * {
    box-sizing: border-box;
    font-family: sans-serif;
  }
  main {
    position: relative;
    height: 500px;
    width: 500px;
    border: 1px solid black;
  }
  .player {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: red;
  }
</style>

<main id="canvas"></main>

<script src="/socket.io/socket.io.js"></script>
<script>
  // Preparação
  const $canvas = document.getElementById('canvas');
  let users = {};

  // Preparação Usuário Atual
	var socket = io();
  const user = { id: socket.id };
  users[socket.id] = user;

  // Renderizando Usuários
  function renderUsers() {
    $canvas.innerHTML = `
      ${Object.keys(users).map((userId) => {
        const user = users[userId]
        return `
          <div class="player" style="top: ${user.y || 0}px; left: ${user.x || 0}px;">${user.id}</div>
        `;
      }).join('')}
    `;
  }
  renderUsers();


  window.addEventListener('keydown', (e) => {
    console.log(e);
    const moves = {
      ArrowUp: { x: 0, y: -10 },
      ArrowDown: { x: 0, y: 10 },
      ArrowLeft: { x: -10, y: 0 },
      ArrowRight: { x: 10, y: 0 }
    };
    
    const move = moves[e.key];
    if (move) socket.emit('ON_USER_MOVE', { id: socket.id, move });
  });

  socket.on('ON_USERS_UPDATE', (updatedUsers) => {
    users = JSON.parse(updatedUsers);
    console.log(users);
    renderUsers();
  });
</script>
